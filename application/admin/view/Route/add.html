{extend name="index" /} {block name="content"}
<div class="panel-body"></div>

<div ng-app="app" ng-controller="routeController">
    
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default">
                <div class="panel-body">
                    <div class="row">
                        <form class="form-horizontal" action="{:url('save')}" method="post">
                            <div class="form-group">
                                <label class="col-md-2 control-label">名称</label>
                                <div class="col-md-3">
                                    <input type="text" class="form-control" name="name" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">出发地</label>
                                <div class="col-md-3">
                                    <select class="form-control" name="start_city_id" >
                                       {volist name="basicInfo['StartCityModels']" id="StartCityModel"}
                                       <option value="{$StartCityModel->getData('id')}">{$StartCityModel->getData('name')}</option>
                                       {/volist}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">目的地</label>
                                <div class="col-md-3">
                                    <select class="form-control" name="destination_city_id">
                                        {volist name="basicInfo['DestinationCityModels']" id="DestinationCityModel"}
                                       <option value="{$DestinationCityModel->getData('id')}">{$DestinationCityModel->getData('name')}</option>
                                       {/volist}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">酒店</label>
                                <div class="col-md-3">
                                    <select class="form-control" name="hotel_id">
                                        {volist name="basicInfo['HotelModels']" id="HotelModel"}
                                       <option value="{$HotelModel->getData('id')}">{$HotelModel->getData('name')}</option>
                                       {/volist}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">出发航班</label>
                                <div class="col-md-3">
                                    <select class="form-control"  name="begin_flight_id">
                                        {volist name="basicInfo['FlightModels']" id="FlightModel"}
                                       <option value="{$FlightModel->getData('id')}">{$FlightModel->getData('number')}</option>
                                       {/volist}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">返回航班</label>
                                <div class="col-md-3">
                                    <select class="form-control"  name="back_flight_id">
                                        {volist name="basicInfo['FlightModels']" id="FlightModel"}
                                       <option value="{$FlightModel->getData('id')}">{$FlightModel->getData('number')}</option>
                                       {/volist}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">开始日期</label>
                                <div class="col-md-3">
                                    <input type="date" name="start_time" class="form-control" min="0" required/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">行程天数</label>
                                <div class="col-md-3">
                                    <input type="number" name="days" class="form-control" min="0" required/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">出发日期——起</label>
                                <div class="col-md-3">
                                    <input type="date" name="begin_time" class="form-control" ng-model="begin_time" required />
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">出发日期——止</label>
                                <div class="col-md-3">
                                    <input type="date" class="form-control" ng-model="deadline" name="deadline" required />
                                </div>
                                <p class="text-danger" ng-show="promptInfo">
                                    <span>须大于等于“出发日期——起”</span>
                                </p>
                            </div>
                            
                            <div ng-show="myValue">
                            <table class="table table-hover table-bordered" style="width: 400px;margin-left: 178px;">
                                <tr>
                                    <th width="30%">日期</th>
                                    <th width="70%">价格</th>
                                </tr>
                                <tr ng-repeat="(key, date) in dates">
                                    <td><input type="hidden" name="date[]" value="{{date}}">{{date}}</td>
                                    <td><input type="number" class="form-control" min="0" name="price[]" required/></td>
                                </tr>
                            </table>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">描述信息</label>
                                <div class="col-md-3">
                                    <input type="text" name="description" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">选择间数</label>
                                <div class="col-md-3">
                                    <input type="number" name="check_in_rooms" class="form-control" min="0" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">入住天数</label>
                                <div class="col-md-3">
                                    <input type="number" name="check_in_days" class="form-control" min="0" required/>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="col-md-2 control-label">起价</label>
                                <div class="col-md-3">
                                    <input type="number" name="starting_price" class="form-control" required/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">标价</label>
                                <div class="col-md-3">
                                    <input type="number" name="standard_price" class="form-control" required/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">选择客服</label>
                                <div class="col-md-3">
                                    <input type="text" name="service_phone" class="form-control" required/>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 text-right" value="">首页推荐</label>
                                <div class="col-md-3">
                                    <input id="radio1" type="radio"  ng-model="isHomeRecommend" name="isHomeRecommend" value="0">&nbsp;&nbsp;
                                    <label for="radio1">是</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <input id="radio2" type="radio" ng-model="isHomeRecommend" name="isHomeRecommend" value="1">&nbsp;&nbsp;
                                    <label for="radio2">否</label>
                                </div>
                                <div ng-show="isHomeRecommend == '0'" class="form-group">
                                    <label class="col-md-1 control-label">权重</label>
                                    <div class="col-md-3">
                                        <input class="form-control" type="number" min="0" name="homeRecommendWeight">
                                       
                                    </div>
                                    <p class="text-danger">
                                        <span >*权重越大，显示越靠前</span>
                                    </p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 text-right" value="">精选</label>
                                <div class="col-md-3">
                                    <input id="radio3" type="radio"  ng-model="isChosen" name="isChosen" value="0">&nbsp;&nbsp;
                                    <label for="radio3">是</label> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <input id="radio4" type="radio" ng-model="isChosen" name="isChosen" value="1">&nbsp;&nbsp;
                                    <label for="radio4">否</label>
                                </div>
                                <div ng-show="isChosen == '0'" class="form-group">
                                    <label class="col-md-1 control-label">权重</label>
                                    <div class="col-md-3">
                                       <input class="form-control" type="number" min="0" name="chosenWeight">
                                    </div>
                                    <p class="text-danger">
                                        <span >*权重越大，显示越靠前</span>
                                    </p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 text-right">详情</label>
                                <div class="col-md-9">
                                    <textarea name="content" id="textarea1">
                                    <p>请输入内容...</p>
                                </textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-offset-3 col-md-9">
                                    <button type="submit" ng-disabled="promptInfo" class="btn btn-md btn-success"><i class="fa fa-check "></i>确认</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<script>
app.controller('routeController', function($scope) {
    //监听开始时间和出发时间两个字段
    $scope.$watch('[begin_time, deadline]', function() {
        //获取开始日期和截止日期之间相隔的天数
        $scope.dates = getDates($scope.begin_time, $scope.deadline);

        //判断用户是否在开始日期、截止日期输入值
        if ($scope.begin_time && $scope.deadline) {
            //判断截止日期是否大于开始日期
            if ($scope.begin_time <= $scope.deadline) {
                $scope.myValue = true;
            } else {
                $scope.myValue = false;
                $scope.promptInfo = true;
            }
            
        }

    });

    //判断“出发日期——起”是否小于“出发日期——止”

    //获取两个日期的中间天数
    function getDates( d1, d2 ){
      var oneDay = 24*3600*1000;
      for (var d=[],ms=d1*1,last=d2*1;ms<last;ms+=oneDay){
        d.push(new Date(ms).Format("yyyy-MM-dd"));

      }
      d.push(d2.Format("yyyy-MM-dd"));
      return d;
    }

    //设置日期格式
    // 对Date的扩展，将 Date 转化为指定格式的String
    // 月(M)、日(d)、小时(h)、分(m)、秒(s)、季度(q) 可以用 1-2 个占位符， 
    // 年(y)可以用 1-4 个占位符，毫秒(S)只能用 1 个占位符(是 1-3 位的数字) 
    // 例子： 
    // (new Date()).Format("yyyy-MM-dd hh:mm:ss.S") ==> 2006-07-02 08:09:04.423 
    // (new Date()).Format("yyyy-M-d h:m:s.S")      ==> 2006-7-2 8:9:4.18 
    Date.prototype.Format = function (fmt) {  
        var o = {
            "M+": this.getMonth() + 1, //月份 
            "d+": this.getDate(), //日 
            "h+": this.getHours(), //小时 
            "m+": this.getMinutes(), //分 
            "s+": this.getSeconds(), //秒 
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
            "S": this.getMilliseconds() //毫秒 
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
        if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }

});
</script>
{/block}
